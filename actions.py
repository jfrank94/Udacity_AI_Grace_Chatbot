from rasa_sdk import Action
from rasa_sdk.events import SlotSet
from rasa_sdk import Tracker
import pandas as pd
import random
import math
import emoji

class ActionMessageOrPicture(Action):
  def name(self):
    return "action_retrieve_messages_or_photos"

  def retrieve_db(self, type_output=""):
      submissions_df = pd.read_csv("Submissions-Grid view.csv")
      unique_slack_message = {}
      unique_slack_photo = {}
      for index, row in submissions_df.iterrows():
          slack_id = row['Slack ID']
          message = row['Message']
          photos_arr = row['Photos']
          if type(photos_arr) == str:
              photos = photos_arr.split()
              photos = [url.replace("(", "").replace(")", "") for url in photos if 'https' in url]
              if slack_id not in unique_slack_photo:
                  unique_slack_photo[slack_id] = photos

          if slack_id not in unique_slack_message:
              unique_slack_message[slack_id] = message

      if type_output == 'message':
          random_choice_message = random.choice(list(unique_slack_message.items()))
          slack_id, message = random_choice_message[0], random_choice_message[1]
          return [slack_id, message]
      elif type_output == 'photo':
          random_choice_photo = random.choice(list(unique_slack_photo.items()))
          slack_id, photo = random_choice_photo[0], random_choice_photo[1]
          return [slack_id, photo]

  def run(self, dispatcher, tracker, domain):
    group = tracker.get_slot("group")
    if group == "photos":
        slack_id, photos = self.retrieve_db("photo")
        dispatcher.utter_message("This is from {}!".format(slack_id))
        for photo in photos:
            if ".mp4" in photo:
                dispatcher.utter_message("It looks like we have a video!")
            if ".mp3" in photo:
                dispatcher.utter_message("It looks like we have an audio!")
            dispatcher.utter_message(photo)
    elif group == "messages":
           slack_id_photo_arr = self.retrieve_db("message")
           slack_id = slack_id_photo_arr[0]
           message = slack_id_photo_arr[1]
           if slack_id[0] == "@":
               slack_id = slack_id.replace("@", "")
           dispatcher.utter_message("This is from {}!".format(slack_id))
           dispatcher.utter_message(message)
    elif group == "geethas":
           dispatcher.utter_message("Geetha, I'm sorry that my randomized algorithm has such a bias against you, but here's your message!")
           dispatcher.utter_message("Grace, your dream of being the best community moderator has come true. You are indeed the best. Next target, just become the CEO of Udacity.")
    elif group == "surprises":
        dispatcher.utter_message("Beep-boop! My creator has a special message for you all!")
        dispatcher.utter_message("ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ")
        dispatcher.utter_message("Firstly, I want to thank @Clayton.Udacity for collaborating with me with the deployment and announcement of this initiative. I also have to thank @Grace.Udacity as well. I know this gift was for you, but I am so grateful that you were able to help out with the deployment of your gift. Iâ€™m so glad you loved it.\nAlso, thank you to all who have contributed to this initiative. You were the driving force to put a smile on Graceâ€™s face. Your messages were heartfelt and your videos/photos were hilarious and equally sentimental. Nearly 100 of you made it possible to make this initiative possible!")
        dispatcher.utter_message("ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ")
        dispatcher.utter_message("ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–")
        dispatcher.utter_message("Letâ€™s start reminiscing, shall we. Where to start? Well, when I initially joined this program, I wasnâ€™t 100% sure if I would be contributing (especially at the level that I am right now). You see, in the past FB challenge over the summer, I was juggling many things at the time, and I was only able to contribute to one initiative on there. To be honest, I wasnâ€™t very interested in AI security as well, so my heart wasnâ€™t in it either.\nHowever, for this course however, DL was up my alley. Iâ€™ve already taken Andrew Ngâ€™s DL specialization prior to this program, so I had some knowledge of what I was getting into. The lessons from this course were pretty good, albeit lacking in some explanations in some of the later lessons. What really pulled me into this course was of course, the community. When I initially started, I had sort of a rough start. Everything was overwhelming and I was second guessing myself whether Iâ€™ll be able to really participate this time around.\nOnce I was able to get over my two rounds of colds/flus back in December, I was instantly pulled into the community. I started to really get serious about updating on #60_days_of_udacity and the #sg_est_time_zonians. At the time, I was updating a lot about the work I was doing with the NYAIH groupâ€¦and for the first time in my life I think, people started to see me as a role model. Because I wanted to go into detail about the process, many people here were very interested in the work I was contributing to, and the compliments and encouragement started to flood in. I was so overwhelmed with emotion that I started put some pressure to myself to live up to that standard.\nHowever, I did wanted to be as transparent and honest with people as possible. I am still a novice in this space. I truly believe in the philosophy of the â€œbeginnerâ€™s mindâ€. Even if I ever do reach that level of expert, Iâ€™ll always keep updating myself on the latest models/algorithms that are out there in the space.\nThis program made grow as a person, truly, to not be afraid of taking some leadership. I really wanted to push myself to see how far I can go with organizing things, presenting things, etc. I know I am not the brightest nor the best leader out there, but I didnâ€™t really care at that point. I knew that Iâ€™ll make mistakes and say something wrong or spend sometime on a bug that would take me hours to figure out. Thatâ€™s how you grow. The line isnâ€™t always linear, but thatâ€™s alright. You really do need to make mistakes in order to reach some semblance of expertise as time goes on. I just want everyone to know that Iâ€™m just like everyone else who just have a passion for their field. We all start at different journeys in our lives. Some of us are prodigies whereas others will take years in order to reach to some level of professional, and you know what? Thatâ€™s okay. Even the most intelligent of us know that there is a never ending tunnel of learning, implementing, experimenting, and so on.\nNow, without further adoâ€¦letâ€™s get on to the shoutouts.")
        dispatcher.utter_message("ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–ğŸ’–")
        dispatcher.utter_message("âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨")
        dispatcher.utter_message("@Shreya Chakrabarti @Julia @Lois Leal @Anju Mercian @Deepika @Melissa Smith @Erica G @lau @Diana Burkart @Snehha  @Rasha Salim @Suchismita Goswami @Sushmita Goswami You ladies are amazing in what youâ€™re doing. With Loisâ€™s entryway into the GIS space, to @Erica G studying for her masters in Linguistics and specializing NLP, to @Julia increasing her ever growing skillset in this space, every one of you are amazing. You are truly role models and amazing women to look up to, and wherever you all land in the near future, I know every single one of you all will be able to conquer your fears and have amazing careers (rhyming here)! Iâ€™m so glad that weâ€™ll be connecting during and after the course, so I know we wonâ€™t be able to lose touch with one another, but it has been a pleasure to work with you all on past and ongoing projects and initiatives. You definitely deserve the recognition for all that youâ€™ve contributed to this community as well as making a difference in other peopleâ€™s lives. This is a shoutout in general to the #sg_women_in_ai channel as a whole as well.\n@LuchoTurtle @Carlos Sierra @Nilesh T @Hugo Fitipali @Lois Leal @Julia (I know Iâ€™m tagging both of you twice, but you are included in this as well) Iâ€™ve truly enjoyed the invigorating conversations weâ€™ve had throughout the course. Carlos, I always look forward to you gushing about your kids and your family. Youâ€™re truly a great husband and father, I am sure of that. Also, itâ€™s so great to get to know people beyond a â€œprofessionalâ€ level as well. Seeing someone who cares about family that much isnâ€™t nothing short of a great role model to look up to.\nLucho, my goodness man, you have truly spread your wings from December until now. I mean, look at you! I know youâ€™re still a novice, but look at how much you have accomplished since the first time we spoke to each other, AND youâ€™re doing your research ontop of that? Seriously, man. Youâ€™re truly underrated in terms of getting recognition in this community. It has been a pleasure to see your growth and squashing your fears to get into the ML space. I honestly look up to you and Iâ€™m always, always, looking forward to your posts in the 60 days channel. I really hope youâ€™re on O.S.â€™s AI fellows channel, because I cannot see where you land next.\nNilesh and Hugo, itâ€™s been great speaking with the both of you, especially in the last month. When we actually just started, I remember some of the posts you guys made on the 60 days channel where I was just in awe of what you guys were doing (especially with Hugoâ€™s posts with regarding the lectures and meetups he was updating us in the channel)  You were honestly pushing me (secretly) to research more and to expand my knowledge on the models I was using throughout the NYAIH project. Hugo, I have a ton of articles Iâ€™ve saved up from your posts that I still need to read lol. But, thank you both for being some of our best and brightest here on the community. Yâ€™all are truly #AIGoals for sure.\nJulia, Iâ€™ve truly enjoyed our conversations here, especially about AI ethics. It was great to meet someone who shares my same concerns about the liberalization of AI in terms of the societal harm it can pose. I know AI ethics mean a lot to you, so I do hope that with the knowledge youâ€™ve gained from this space and beyond, youâ€™ll be one of our leaders in this field on how to help regulate the implementation of these models. AI can be a net positive, but it can also have negative affects (which it has already) to our behaviors. Having a regulating body who understands the code behind the models is much needed in our society as we become increasingly technocratic. Also, youâ€™re just a badass woman in general. I meanâ€¦practicing kung-fu on a regular basis, especially knowing your back story behind the reason why??? Amazing, fantastic, terrific, sensational!!!! Iâ€™m so honored to know of a woman of such stature like yourself.\nLois, what can I say? Every post you make is essentially a party, lol! I know youâ€™re always updating us with your incredible work behind your masterâ€™s, which is indeed amazing (please keep updating us on the AI Fellows slack if you do have the time), but your posts always attract the party selves in us, and Iâ€™m always having a good time reading peopleâ€™s comments on your posts on the 60 days channel. I always looked forward to the One Piece quotes you had for us on each day. Thank you for referencing the earlier seasons, because I dropped One Piece more than 10 years ago, haha. Iâ€™m not even close to the end of the pre-time skip era. I truly enjoyed our conversations with one another in terms of anime and GIS. Youâ€™re going to rock in this field, I have no doubt in my mind of that.\nAlso, I want to make a special shoutout to Shreya once again as well. I remember when we just, just started, you were one of the first people who were always encouraging me and supporting me throughout this journey. Itâ€™s funny, because I definitely saw you as more of a leader and role model (which you still pretty much are), especially since right out of the gate, you were pushing yourself to get involved into many initiatives. I know youâ€™re more busy with your new job, but your presence has NOT been forgotten as I see many people to do this day including you in their shoutouts. Thatâ€™s a testament to the influence you have on this community!")
        dispatcher.utter_message("âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨")
        dispatcher.utter_message("âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨")
        dispatcher.utter_message("Oh my, okay, this is getting hella long now, but I have some more shoutouts to go, so just bear with me lol. It was great working with everyone in the #sg_slowandsteady community. I really do apologize for not releasing the FAQ as by the time I ended the initiative, it was already a week out from the program ending. However, I truly loved what everyone has contribute in the â€œGrievances & Issuesâ€ initiative and I truly hoped that it benefitted folks in the long run. :) Especially if they ever get into similar programs like the one here on Udacity.\nI also had such a great time during a big study jam last month. It was awesome working with @Adrian @Anju Mercian and everyone else on the Style Transfer competition. Many of you guys had awesome submissions. Truly, some of you guys have such a strong artistic style, even through the use of â€œmachinesâ€. Special shoutouts to @Shymaa Othman @Boris @Nathlieae for having some of the strongest standouts during the competition (in my eyes, anyway). I still have all of our submissions on the Airtable, so if anyone is interested in seeing the effort that everyone put in, you can just ping me on here or on the AI Fellows slack. I also had such a great time on the #random channel as well. @Geetha and @Rohan Chittora (and @Deepika)! had such amazing events throughout, that I felt like my weekend wasnâ€™t wasted at all. It was such fun seeing everyoneâ€™s responses to the puzzles and the memes and so much more.\nItâ€™s been great working with everyone in the #sg_ai_in_medial_science channel on our ongoing projects. Iâ€™m glad weâ€™re all contributing our efforts on the Leukemia half of the project, and I truly cannot wait for what we have in store in the near future. @Juber Rahman and @Rasha Salim, I just want to thank you guys especially for going out of your way, especially you, Rasha, to do more research and EDA even though weâ€™re all beginners here. This is the attitude I like to see out of this group, and Iâ€™m also glad we have folks like @Slaure with the strong domain knowledge to help guide us in this journey!\nI really wish I had started the mentorship initiative earlier, but Iâ€™m so glad to see that many of you guys within the <2 week timeline we had got enormous benefit out of it. I just also want to thank @Anju Mercian for helping me out, especially on the #mentorship_east channel as well. Iâ€™m glad the mentees used the space as a source of accountability to finish the course on time. @Pryianka, you went from still being on lesson 3 to basically finishing the course within a week. That was awesome to witness.\nAlso, shoutouts my fellow student leaders who have been a huge force for making this community amazing!\nNow, I have so much more to say, but like I said, this was already getting too long, haha. But, I am so grateful to every single one of you all in this community. Through the interactions weâ€™ve had at every level, to the ongoing collaborations weâ€™re doing right now, and everything in-between. It was an honor to serve for this community, and I wish every single on of you all great success in your careers and everything that matters to you in your lives. Thank you all so much.")
        dispatcher.utter_message("âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨")
        dispatcher.utter_message("My creator's words are quite long-winded, but I really hope you enjoyed what she wrote for you all. :)")
